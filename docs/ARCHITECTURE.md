# æŠ€æœ¯æ¶æ„æ–‡æ¡£ (Technical Architecture)

## 1. ç³»ç»Ÿæ¦‚è§ˆ (System Overview)
æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº **Streamlit** çš„å¤šé¡µé¢äº¤äº’å¼å¼ºåŒ–å­¦ä¹ æ•™å­¦å·¥å…·ã€‚æ—¨åœ¨é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼ï¼Œå¸®åŠ© 8 å¹´çº§å­¦ç”Ÿç†è§£ Q-Learning å’Œ Deep Q-Network (DQN) çš„æ ¸å¿ƒæ¦‚å¿µã€‚

### æŠ€æœ¯æ ˆ
-   **å‰ç«¯/äº¤äº’**: Streamlit (Python Web æ¡†æ¶)
-   **ç¯å¢ƒæ¨¡æ‹Ÿ**: Gymnasium (`FrozenLake-v1`, `LunarLander-v3`)
-   **ç®—æ³•æ ¸å¿ƒ**:
    -   NumPy (å®ç°è¡¨æ ¼å‹ Q-Learning)
    -   Stable-Baselines3 (æä¾› DQN æ¨¡å‹æ”¯æŒ)
-   **æ•°æ®å¤„ç†**: Pandas (ç”¨äºå›¾è¡¨æ•°æ®ç»“æ„åŒ–)

---

## 2. æ ¸å¿ƒæ¨¡å—è®¾è®¡ (Core Modules)

### 2.1 çŠ¶æ€ç®¡ç† (State Management)
ç”±äº Streamlit çš„è¿è¡Œæœºåˆ¶æ˜¯â€œæ¯æ¬¡äº¤äº’é‡æ–°è¿è¡Œæ•´ä¸ªè„šæœ¬â€ï¼Œæˆ‘ä»¬ä½¿ç”¨ `st.session_state` æ¥æŒä¹…åŒ–å…³é”®æ•°æ®ã€‚

| é”®å (Key) | ç±»å‹ | ä½œç”¨ |
| :--- | :--- | :--- |
| **é€šç”¨** | | |
| `training_completed` | `bool` | FrozenLake è®­ç»ƒå®Œæˆæ ‡è®°ã€‚ |
| `trained_q_table` | `numpy.ndarray` | FrozenLake è®­ç»ƒå¥½çš„ Q è¡¨ã€‚ |
| **LunarLander** | | |
| `lunar_training_completed` | `bool` | LunarLander Q-Learning è®­ç»ƒå®Œæˆæ ‡è®°ã€‚ |
| `lunar_q_table` | `dict` | LunarLander çš„ç¨€ç– Q è¡¨ (ä½¿ç”¨å­—å…¸å­˜å‚¨)ã€‚ |
| `lunar_results` | `pandas.DataFrame` | LunarLander è®­ç»ƒè¿‡ç¨‹ç»Ÿè®¡æ•°æ®ã€‚ |
| `dqn_model` | `DQN` | åŠ è½½çš„ Stable-Baselines3 DQN æ¨¡å‹å¯¹è±¡ã€‚ |
| `dqn_source` | `str` | æ¨¡å‹æ¥æº: "student" (è‡ªè®­ç»ƒ) æˆ– "expert" (é¢„è®­ç»ƒ)ã€‚ |
| `dqn_results` | `dict` | DQN æµ‹è¯•çš„ç»Ÿè®¡ç»“æœ (ç”¨äºå¯¹æ¯”)ã€‚ |

### 2.2 ç¦»æ•£åŒ–åŒ…è£…å™¨ (`DiscretizedObservationWrapper`)
ä¸ºäº†è®©è¡¨æ ¼å‹ Q-Learning èƒ½å¤Ÿå¤„ç† LunarLander çš„è¿ç»­çŠ¶æ€ç©ºé—´ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ Gym Wrapperã€‚

*   **åŸç†**: å°†è¿ç»­çš„ 8 ç»´çŠ¶æ€å‘é‡ï¼ˆåæ ‡ã€é€Ÿåº¦ã€è§’åº¦ç­‰ï¼‰æ˜ å°„ä¸ºç¦»æ•£çš„æ¡¶ (Bucket) ç´¢å¼•ã€‚
*   **å®ç°**: `observation(self, obs)` æ–¹æ³•å°†æ¯ä¸ªç»´åº¦çš„è¿ç»­å€¼æ˜ å°„åˆ° `[0, n_buckets-1]` çš„æ•´æ•°åŒºé—´ã€‚
*   **ç›®çš„**: æ¼”ç¤ºâ€œç»´åº¦ç¾éš¾â€â€”â€”å³ä½¿æ¯ä¸ªç»´åº¦åªåˆ‡åˆ† 5 ä»½ï¼Œæ€»çŠ¶æ€æ•°ä¹Ÿä¼šçˆ†ç‚¸å¼å¢é•¿ ($5^8 \approx 390,625$)ã€‚

### 2.3 è®­ç»ƒå¼•æ“
ç³»ç»ŸåŒ…å«ä¸¤ä¸ªç‹¬ç«‹çš„è®­ç»ƒ/æ¨ç†å¼•æ“ï¼š

1.  **FrozenLake Q-Learning**:
    *   ä½¿ç”¨ NumPy æ•°ç»„å­˜å‚¨ Q è¡¨ã€‚
    *   å®ç°äº† Epsilon-Greedy ç­–ç•¥å’Œ Random Tie-Breakingã€‚
    *   åŒ…å« Reward Shaping (æ‰å‘æƒ©ç½š)ã€‚

2.  **LunarLander Q-Learning**:
    *   ä½¿ç”¨ Python å­—å…¸å­˜å‚¨ç¨€ç– Q è¡¨ (ä»…å­˜å‚¨è®¿é—®è¿‡çš„çŠ¶æ€)ã€‚
    *   æ¼”ç¤ºåœ¨è¿ç»­ç©ºé—´ä¸­ Q-Learning çš„å¤±æ•ˆã€‚

3.  **LunarLander DQN**:
    *   ä½¿ç”¨ `stable_baselines3.DQN` è¿›è¡Œè®­ç»ƒã€‚
    *   **å­¦ç”Ÿå¯è°ƒå‚æ•°ï¼ˆ7ä¸ªï¼‰**ï¼š
        - å­¦ä¹ ç‡ (Learning Rate): 0.0001~0.005
        - æŠ˜æ‰£å› å­ (Gamma): 0.90~0.99
        - åˆå§‹æ¢ç´¢ç‡: 0.5~1.0
        - æœ€ç»ˆæ¢ç´¢ç‡: 0.01~0.2
        - æ¢ç´¢å æ¯”: 0.2~0.5
        - æ‰¹æ¬¡å¤§å°: 32~256
        - è®­ç»ƒæ­¥æ•°: 10,000~200,000
    *   **å®æ—¶ä¸‰å›¾å¯è§†åŒ–**ï¼š
        1. å¹³å‡å¥–åŠ±å›¾ï¼ˆåŒæ›²çº¿ï¼šå½“å‰å¥–åŠ± + å¹³å‡å¥–åŠ±ï¼‰
        2. æˆåŠŸç‡å›¾ï¼ˆå¸¦æŒ‡æ•°å¹³æ»‘ï¼Œæ ‡å‡†ï¼šreward â‰¥ 0ï¼‰
        3. æ¢ç´¢ç‡ä¸‹é™å›¾
    *   **è‡ªå®šä¹‰å›è°ƒ (`StreamlitCallback`)**ï¼š
        - æ¯200æ­¥é‡‡æ ·ä¸€æ¬¡è®­ç»ƒæŒ‡æ ‡
        - æˆåŠŸç‡ä½¿ç”¨EMAå¹³æ»‘ï¼ˆÎ±=0.1ï¼‰é¿å…é”¯é½¿æ³¢åŠ¨
        - è®­ç»ƒæ•°æ®æŒä¹…åŒ–åˆ° `session_state`
    *   **æµ‹è¯•æ¼”ç¤º**ï¼š10è½®å¯è§†åŒ–æµ‹è¯•ï¼Œæ˜¾ç¤ºæˆåŠŸç‡ã€å¹³å‡å¥–åŠ±ã€å¹³å‡æ­¥æ•°

### 2.4 UI æ¸²æŸ“æ¶æ„ (UI Rendering)
ä¸ºäº†è§£å†³ Streamlit åœ¨é«˜é¢‘åŠ¨ç”»ä¸‹çš„æ¸²æŸ“åŒæ­¥é—®é¢˜ï¼Œæˆ‘ä»¬ç»Ÿä¸€é‡‡ç”¨äº† **"å¸ƒå±€åˆ†ç¦» + å»¶è¿ŸåŠ è½½"** çš„æ¨¡å¼ï¼š

1.  **å¸ƒå±€**: ä½¿ç”¨ `st.columns` å°†é¡µé¢åˆ’åˆ†ä¸ºâ€œå›¾è¡¨åŒºâ€ã€â€œæ•°æ®åŒºâ€å’Œâ€œæ¼”ç¤ºåŒºâ€ã€‚
2.  **æ¼”ç¤ºåŒº**: ä»…åœ¨ç”¨æˆ·ç‚¹å‡»â€œå¼€å§‹æµ‹è¯•â€æŒ‰é’®ååŠ¨æ€ç”Ÿæˆ `st.empty` å ä½ç¬¦ã€‚
3.  **åŠ¨ç”»**: åœ¨ Python å¾ªç¯ä¸­æ›´æ–°å ä½ç¬¦çš„å†…å®¹ (`image_placeholder.image(frame)`)ï¼Œå¹¶é…åˆ `time.sleep()` æ§åˆ¶å¸§ç‡ã€‚

---

## 3. æ–‡ä»¶ç»“æ„ (File Structure)

```text
gym_qhxx/
â”œâ”€â”€ Home.py                 # ä¸»ç¨‹åºå…¥å£ (è¯¾ç¨‹ç›®å½•)
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ 1_ğŸ§Š_FrozenLake.py  # åŸºç¡€ç¯‡ï¼šå†°æ¹–æ¢é™©
â”‚   â””â”€â”€ 2_ğŸš€_LunarLander.py # è¿›é˜¶ç¯‡ï¼šæœˆçƒç€é™†
â”œâ”€â”€ requirements.txt        # é¡¹ç›®ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ARCHITECTURE.md     # æœ¬æŠ€æœ¯æ¶æ„æ–‡æ¡£
â”‚   â”œâ”€â”€ USER_MANUAL.md      # ç”¨æˆ·æ‰‹å†Œ
â”‚   â””â”€â”€ WORKSHEET.md        # å­¦ç”Ÿä»»åŠ¡å•
â””â”€â”€ README.md               # é¡¹ç›®å¿«é€Ÿå…¥é—¨
```

## 4. å…³é”®ç®—æ³•å…¬å¼
Q-Learning æ›´æ–°å…¬å¼ (é€šç”¨)ï¼š

```python
new_value = old_value + learning_rate * (custom_reward + discount_factor * next_max - old_value)
```

---

## 5. ç»´æŠ¤æŒ‡å—
*   **ä¿®æ”¹å‚æ•°èŒƒå›´**: ç›´æ¥åœ¨å„é¡µé¢ä»£ç çš„ `compact_slider` è°ƒç”¨ä¸­ä¿®æ”¹ã€‚
*   **DQN æ¨¡å‹**: ç›®å‰ä½¿ç”¨ Hugging Face ä¸Šçš„é¢„è®­ç»ƒæ¨¡å‹ã€‚å¦‚éœ€æ›´æ¢ï¼Œè¯·æ›¿æ¢ `dqn_lunar_model.zip` æ–‡ä»¶ã€‚
